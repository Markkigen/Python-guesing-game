import random
import json
import time
import os

SCORE_FILE = "high_scores.json"


class GuessingGame:
    def __init__(self):
        self.total_score = 0
        self.player_name = ""
        self.load_scores()

    def load_scores(self):
        if os.path.exists(SCORE_FILE):
            with open(SCORE_FILE, "r") as file:
                self.high_scores = json.load(file)
        else:
            self.high_scores = {}

    def save_scores(self):
        with open(SCORE_FILE, "w") as file:
            json.dump(self.high_scores, file, indent=4)

    def welcome(self):
        print("\n GUESSING GAME ")
        self.player_name = input("Enter your name: ").strip().title()

    def choose_level(self):
        print("\nChoose Difficulty:"
        print("1. Easy (1‚Äì10 | 5 attempts)")
        print("2. Medium (1‚Äì50 | 7 attempts)")
        print("3. Hard (1‚Äì100 | 8 attempts)")
        print("4. Extreme (1‚Äì500 | 10 attempts)")

        while True:
            choice = input("Select level: ")
            levels = {
                "1": (10, 5),
                "2": (50, 7),
                "3": (100, 8),
                "4": (500, 10)
            }
            if choice in levels:
                return levels[choice]
            print("Invalid choice.")

    def get_guess(self, max_number):
        while True:
            value = input(f"Guess (1‚Äì{max_number}): ")
            if value.isdigit():
                value = int(value)
                if 1 <= value <= max_number:
                    return value
            print("Invalid input.")

    def give_hint(self, secret, guess):
        difference = abs(secret - guess)
        if difference <= 3:
            return " Very close!"
        elif difference <= 10:
            return "üå° Close"
        else:
            return "‚ùÑ Far"

    def calculate_score(self, attempts_left, time_taken):
        base = attempts_left * 20
        time_bonus = max(0, int(100 - time_taken))
        return base + time_bonus

    def play_round(self):
        max_number, attempts = self.choose_level()
        secret = random.randint(1, max_number)

        print(f"\nI picked a number between 1 and {max_number}")
        start_time = time.time()

        for attempt in range(1, attempts + 1):
            guess = self.get_guess(max_number)

            if guess == secret:
                time_taken = int(time.time() - start_time)
                score = self.calculate_score(attempts - attempt + 1, time_taken)
                print(f"\nüéâ Correct in {attempt} tries!")
                print(f"‚è± Time: {time_taken}s")
                print(f"üèÜ Score earned: {score}")
                return score

            hint = self.give_hint(secret, guess)
            print(f"{'Too low' if guess < secret else 'Too high'} ‚Äî {hint}")
            print(f"Attempts left: {attempts - attempt}")

        print(f"\n Game Over! Number was {secret}")
        return 0

    def update_high_score(self):
        best = self.high_scores.get(self.player_name, 0)
        if self.total_score > best:
            self.high_scores[self.player_name] = self.total_score
            self.save_scores()
            print("üèÖ New personal high score!")

    def show_high_scores(self):
        print("\nüèÜ HIGH SCORES")
        for name, score in sorted(self.high_scores.items(), key=lambda x: x[1], reverse=True)[:5]:
            print(f"{name}: {score}")

    def start(self):
        self.welcome()

        while True:
            self.total_score += self.play_round()
            again = input("\nPlay again? (y/n): ").lower()
            if again != "y":
                break

        self.update_high_score()
        print(f"\n Final Score: {self.total_score}")
        self.show_high_scores()
        print("Thanks for playing!")


if __name__ == "__main__":
    GuessingGame().start()
